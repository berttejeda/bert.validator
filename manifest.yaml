vars:
  my_global_var: "{{ .USER }}_my_global_value"
  "{{ .USER }}": "{{ .USER }}"

templates:
  function_test: |-
    function function_test(){
      echo Parameter 1 value is ${yellow}${1}${nc}
      echo Parameter 2 value is ${red}${2}${nc}
      echo My Global Var is ${my_global_var}
    }

validations:
  - name: "FunctionTest"
    show_output: true
    script: |-
      {{ printf "%s\n" .function_test | nindent 6 }}
      echo 1 2 3

      # these are env vars from headers (globals/locals merged):
      echo "Length is ${length}"
      echo "Site is ${SITE_NAME}"
      echo "Session ID is ${SESSION_ID}"

      if (( length < 4 )); then
        exit 0
      else
        exit 1
      fi
    outcomes:
      fail:
        message: Length ${length} is more than 4 for site ${SITE_NAME}!
      pass:
        message: Length ${length} is less than 4 for site ${SITE_NAME}!
    vars:
      length: 0
      SITE_NAME: site1
      SESSION_TOKEN: $(curl -s https://session-server.example.com/api/v2/get-session-token)
      SESSION_ID: ${USER}-${SITE_NAME}-${my_global_var}-${SESSION_TOKEN}